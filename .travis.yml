sudo: required
language: generic
dist: trusty
addons:
  apt:
    packages: libc6-i386
cache:
  directories:
  - "$HOME/gcc-arm-none-eabi-6-2017-q1-update"
install:
- export GCC_DIR=$HOME/gcc-arm-none-eabi-6-2017-q1-update
- export GCC_ARCHIVE=$HOME/gcc-arm-none-eabi-6-2017-q1-update-linux.tar.bz2
- export GCC_URL=https://developer.arm.com/-/media/Files/downloads/gnu-rm/6_1-2017q1/gcc-arm-none-eabi-6-2017-q1-update-linux.tar.bz2?product=GNU%20ARM%20Embedded%20Toolchain,64-bit,,Linux,6-2017-q1-update
- if [ ! -e $GCC_DIR/bin/arm-none-eabi-g++ ]; then wget $GCC_URL -O $GCC_ARCHIVE;
  tar xfj $GCC_ARCHIVE -C $HOME; fi
- sudo add-apt-repository "deb http://ftp.debian.org/debian jessie-backports main"
- sudo apt-get -qq update
- sudo apt-get install -t jessie-backports -y --force-yes gcc-arm-none-eabi libnewlib-arm-none-eabi
  libstdc++-arm-none-eabi-newlib
script:
- mkdir -p mchf-eclipse/build-bl
- mkdir -p mchf-eclipse/build-fw
- mkdir -p mchf-eclipse/build-bl-f7
- mkdir -p mchf-eclipse/build-fw-f7
- cd mchf-eclipse/build-bl
- cd ../build-fw
- make -f ../Makefile ROOTLOC=".." all
- cd ../build-fw-f7
- make -f ../Makefile OPT_GCC_ARM=$GCC_DIR ROOTLOC=".." BUILDFOR="F7" TRX_ID="ovi40"
  TRX_NAME="OVI40" all
- cd ../build-bl
- make -f ../Makefile ROOTLOC=".." bootloader
- cd ../build-bl-f7
- make -f ../Makefile OPT_GCC_ARM=$GCC_DIR ROOTLOC=".." BUILDFOR="F7" TRX_ID="ovi40"
  TRX_NAME="OVI40" bootloader
- cd ..
deploy:
  provider: releases
  api_key:
    secure: DZS3GqUvmvC8nYLFVpcrMN1DvNSx1GOdCCrOg7BNsIlZGnN/jWK21IqLd5/70MqkpbRF8sDYiV+zI4AIrFAU5KkKnhZwVawR8+/5Dj1ukdwEJQMrWKSZ9d/l5B49jP5ytqvgx8RU5grlQNa+CSZPI7C1GH1Adi6NRzj4ALhihGNfwIjViAf9kRXcQF/c46SctgNmfTWNu+qP2P7LhZ1ywDyerkw7q5XAk/6kP68FNloqDHa756HMLwdGNs3ErVSx71tGxvNnc7ox7h+Gs0i43HpP6UvVvYKqtffX0Dw9oo7aSV3b7Skvn7/i3/ZZuXLzoPbf4tVW1jUjc+xyyplwhcO3o+sW3PSATHaVv7Uig/AvXOaywxLoGO0XpAIkbSjNNOdLqj4+hfo22xbwIN2SiFJgb/7B8GA6m5ZIiVQ/dN3ZfhynHFLTG4VcPOjkFo8pgsLRgb+O6TeEjZmu7iEpQ/tkcZT8b1r0R9D9Ku/D0Bf4g7YFrgx95ZFLirV3Z2ibBmbIguls6upfsG/EaXUulwNwTbuSBBHdZvzHroObzvaP5LgP0IZqI27ykfEUOZakRKFzFEoZNz0N6hkNsjnVG6A+kOi48Ic3iE6pjSz7dzt/MdoqRra8qHOKjV03KixMau/hWasVz/9ksdVabRBi3/4Cl9X+1WXdgn7XGeSMYdk=
  file: 
  - mchf-eclipse/build-fw/fw-mchf.bin
  - mchf-eclipse/build-fw-f7/fw-ovi40.bin
  - mchf-eclipse/build-bl/bl-mchf.bin
  - mchf-eclipse/build-bl-f7/bl-ovi40.bin
  - mchf-eclipse/build-fw/fw-mchf.dfu
  - mchf-eclipse/build-fw-f7/fw-ovi40.dfu
  - mchf-eclipse/build-bl/bl-mchf.dfu
  - mchf-eclipse/build-bl-f7/bl-ovi40.dfu
  skip_cleanup: true
  on:
    repo: db4ple/mchf-github
    tags: true
    branches: 
      only:
      - test-my-idea
